(()=>{"use strict";var e=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.classList.remove(e.inactiveButtonClass),n.removeAttribute("disabled")):(n.classList.add(e.inactiveButtonClass),n.setAttribute("disabled","disabled"))};function t(e){"Escape"===e.key&&o(document.querySelector(".pop-up_opened"))}function n(e){e.classList.add("pop-up_opened"),document.addEventListener("keydown",t)}function o(e){e.classList.remove("pop-up_opened"),document.removeEventListener("keydown",t)}var r=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";t.querySelector(".pop-up__save-button").textContent=e?"Сохранение...":n},c=document.forms["edit-form"],i=document.forms["add-form"],u=document.forms["avatar-form"],a=c.querySelector('[name="name"]'),l=c.querySelector('[name="description"]'),s=i.querySelector('[name = "place-name"]'),d=i.querySelector('[name = "link"]'),p=document.querySelector(".profile__name"),f=document.querySelector(".profile__description"),m=document.querySelector("#add-pop-up"),_=document.querySelector("#edit-pop-up"),v=document.querySelector("#pop-up-image"),y=v.querySelector(".pop-up__image"),h=v.querySelector(".pop-up__image-subtitle"),b=document.querySelector("#edit-avatar-pop-up"),S={popUpImage:v,addPopUp:m,editPopUp:_,popUpAvatar:b};function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E,L="https://mesto.nomoreparties.co/v1/plus-cohort-13",C={headers:{authorization:"04133e24-2d24-41c7-9c81-c0a879d407ce","Content-Type":"application/json"}},O=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},P=document.querySelector("#card-template").content,j=document.querySelector(".photo-grid__list");function x(e,t,o,r,c,i){var u=P.querySelector(".photo-grid__item").cloneNode(!0),a=u.querySelector(".photo-grid__photo"),l=u.querySelector(".photo-grid__like-button"),s=u.querySelector(".photo-grid__like-quantity"),d=u.querySelector(".photo-grid__delete-button");return r.find((function(e){return e._id===c}))&&l.classList.add("photo-grid__like-button_liked"),i!==c&&d.classList.add("photo-grid__delete-button_disabled"),u.dataset.id=o,a.src=t,a.alt=e,s.textContent=r.length,u.querySelector(".photo-grid__name").textContent=e,l.addEventListener("click",(function(){!function(e,t,n){var o;e.classList.contains("photo-grid__like-button_liked")?(o=t,fetch("".concat(L,"/cards/likes/").concat(o),k({method:"DELETE"},C)).then(O)).then((function(t){e.classList.remove("photo-grid__like-button_liked"),n.textContent=t.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(L,"/cards/likes/").concat(e),k({method:"PUT"},C)).then(O)}(t).then((function(t){e.classList.add("photo-grid__like-button_liked"),n.textContent=t.likes.length})).catch((function(e){return console.log(e)}))}(l,u.dataset.id,s)})),d.addEventListener("click",(function(e){var t;(t=u.dataset.id,fetch("".concat(L,"/cards/").concat(t),k({method:"DELETE"},C)).then(O)).then((function(t){e.target.closest(".photo-grid__item").remove()}))})),a.addEventListener("click",(function(){n(v),y.src=t,y.alt=e,h.textContent=e})),u}function w(e,t,n,o,r,c){var i=x(e,t,n,o,r,c);j.prepend(i)}v.querySelector(".pop-up__close-button").addEventListener("click",(function(){o(v)}));var A,D=document.querySelector(".profile__avatar");Promise.all([fetch("".concat(L,"/users/me"),C).then(O),fetch("".concat(L,"/cards"),C).then(O)]).then((function(e){p.textContent=e[0].name,f.textContent=e[0].about,D.src=e[0].avatar,E=e[0]._id,e[1].forEach((function(e){w(e.name,e.link,e._id,e.likes,E,e.owner._id)}))})).catch((function(e){return console.log(e)})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){a.value=p.textContent,l.value=f.textContent,n(_)})),c.addEventListener("submit",(function(e){var t;e.preventDefault(),r(!0,c),(t={name:a.value,about:l.value},fetch("".concat(L,"/users/me"),k({method:"PATCH",body:JSON.stringify(t)},C)).then(O)).then((function(e){p.textContent=e.name,f.textContent=e.about,o(_)})).catch((function(e){return console.log(e)})).finally((function(){r(!1,c)}))})),_.querySelector(".pop-up__close-button").addEventListener("click",(function(){o(_)})),document.querySelector(".profile__add-button").addEventListener("click",(function(){n(m)})),i.addEventListener("submit",(function(e){var t;e.preventDefault(),r(!0,i),(t={name:s.value,link:d.value},fetch("".concat(L,"/cards"),k({method:"POST",body:JSON.stringify(t)},C)).then(O)).then((function(e){w(e.name,e.link,e._id,e.likes,E,e.owner._id),i.reset(),o(m)})).catch((function(e){return console.log(e)})).finally((function(){r(!1,i)}))})),m.querySelector(".pop-up__close-button").addEventListener("click",(function(){o(m)})),document.querySelector(".profile__edit-avatar").addEventListener("click",(function(){n(b)})),u.addEventListener("submit",(function(e){e.preventDefault(),r(!0,u),function(e){return fetch("".concat(L,"/users/me/avatar"),k({method:"PATCH",body:JSON.stringify({avatar:e})},C)).then(O)}(u.link.value).then((function(e){D.src=e.avatar,u.reset(),o(b)})).catch((function(e){return console.log(e)})).finally((function(){r(!1,u)}))})),b.querySelector(".pop-up__close-button").addEventListener("click",(function(){o(b)})),Array.from(Object.values(S)).forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("pop-up_opened")&&o(e)}))})),A={formSelector:".pop-up__form",inputSelector:".pop-up__text",submitButtonSelector:".pop-up__save-button",inactiveButtonClass:"pop-up__save-button_disabled",inputErrorClass:"pop-up__text_type_error",errorClass:"pop-up__error_active"},Array.from(document.querySelectorAll(A.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n){var o=Array.from(n.querySelectorAll(t.inputSelector)),r=n.querySelector(t.submitButtonSelector);e(t,o,r),n.addEventListener("submit",(function(){e(t,o,r)})),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){n.validity.valid?function(e,t,n){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),o.classList.remove(e.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),r.textContent=o,r.classList.add(e.errorClass)}(e,t,n,n.validationMessage)}(t,n,c),e(t,o,r)}))}))}(A,t)}))})();